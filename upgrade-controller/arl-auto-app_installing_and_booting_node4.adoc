---
sidebar: sidebar: upgrade-controller_sidebar
permalink: upgrade-controller/arl-auto-app_installing_and_booting_node4.html
keywords:
summary:
---

= Installing and booting node4
:hardbreaks:
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/

//
// This file was created with NDAC Version 2.0 (August 17, 2020)
//
// 2020-12-02 14:33:55.003238
//

[.lead]
You must install node4 in the rack, transfer node2 connections to node4, boot node4, and install ONTAP. You must also reassign any node2 spare disks, any disks belonging to the root volume, and any non-root aggregates that were not relocated to node3 earlier.

==== About this task

The relocation operation is paused at the beginning of this stage. This process is largely automated; the operation pauses to allow you to check its status. You must manually resume the operation. In addition, you must verify the SAN LIFs have successfully moved to node4.

You need to netboot node34 if it does not have the same version of ONTAP 9 that is installed on node2. After you install node4, boot it from the ONTAP 9 image stored on the web server. You can then download the correct files to the boot media device for subsequent system boots, by following the instructions in *xref* Preparing for netboot.

==== Important:

* If you are upgrading a V-Series system connected to storage arrays or a system with FlexArray Virtualization software that is connected to storage arrays, you must complete *xref* Step 1 through *xref* Step 21 , then leave this section and follow instructions in the *xref* Configuring FC ports on node4 and *xref* Checking and configuring UTA/UTA2 ports on node4 sections as needed, entering commands in Maintenance mode. You must then return to this section and resume with* xref* Step 23.
* However, if you are upgrading a system with storage disks, you must complete this entire section and then proceed to *xref* Setting the FC or UTA/UTA2 configuration on node4 entering commands at the cluster prompt.*Steps*

. Make sure that node4 has sufficient rack space.
+
If node4 is in a separate chassis from node2, you can put node4 in the same location as node3. If node2 and node4 are in the same chassis, then node4 is already in its appropriate rack location.

. Install node4 in the rack, following the instructions in the Installation and Setup Instructions for the node model.
. Cable node4, moving the connections from node2 to node4.
+
Cable the following connections, using the instructions in the *Installation and Setup Instructions* or the *FlexArray Virtualization Installation Requirements and Reference* for the node4 platform, the appropriate disk shelf guide, and *the ONTAP 9 High-Availability Configuration Guide*:

** Console (remote management port)
** Cluster ports
** Data ports
** Cluster and node management ports
** Storage
** SAN configurations: iSCSI Ethernet and FC switch ports

[NOTE]
You do not need to move the interconnect card/FC-VI card or interconnect/FC-VI cable connection from node2 to node4 because most platform models have unique interconnect card models. For the MetroCluster configuration, you must move the FC-VI cable connections from node2 to node4. If the new host does not have an FC-VI card, you might need to move the FC-VI card.

. Turn on the power to node4, and then interrupt the boot process by pressing Ctrl-C at the console terminal to access the boot environment prompt.

[NOTE]
When you boot node4, you might see the following warning message:

....
WARNING: The battery is unfit to retain data during a power outage. This is likely because the
         battery is discharged but could be due to other temporary conditions.
         When the battery is ready, the boot process will complete and services will be engaged.
         To override this delay, press 'c' followed by 'Enter'
....

. If you see the warning message in Step 4, take the following actions:
.. Check for any console messages that might indicate a problem other than a low NVRAM battery, and, if necessary, take any required corrective action.
.. Allow the battery to charge and the boot process to complete.*Attention*: Do not override the delay; failure to allow the battery to charge could result in a loss of data.

[NOTE]
Refer to *xref *Preparing for netboot.

. Configure the netboot connection by choosing one of the following actions.

[NOTE]
 You should use the management port and IP as the netboot connection. Do not use a data LIF IP or a data outage might occur while the upgrade is being performed.

|===
|If Dynamic Host Configuration Protocol (DHCP) is... |Then...

|Running
|Configure the connection automatically by using the following command at the boot environment prompt:
ifconfig e0M -auto
|Not running
|Manually configure the connection by entering the following command at the boot environment prompt:
ifconfig e0M -addr=<filer_addr> -mask=<netmask> -gw=<gateway> - dns=<dns_addr> domain=<dns_domain>
<filer_addr> is the IP address of the storage system. <netmask> is the network mask of the storage system.
<gateway> is the gateway for the storage system.
<dns_addr> is the IP address of a name server on your network.
<dns_domain> is the DNS domain name. If you use this optional parameter, you do not need a fully qualified domain name in the netboot server URL; you need only the server's host name.
Other parameters might be necessary for your interface. Enter help ifconfig at the firmware prompt for details.

|===

. Perform netboot on node4:

|===
|For... |Then...

|FAS/AFF8000 series systems
|netboot http://<web_server_ip/path_to_web-
accessible_directory>/netboot/kernel
|All other systems
|netboot http://<web_server_ip/path_to_web-
accessible_directory>/<ontap_version>_image.tgz
|===

The <`path_to_the_web-accessible_directory`> should lead to where you downloaded the `<ontap_version>_image.tgz` in Step 1 in the section *xref *Preparing for netboot.

[NOTE]
Do not interrupt the boot.

. From the boot menu, select option `(7) Install new software first`.
+
This menu option downloads and installs the new ONTAP image to the boot device.

[NOTE]
Disregard the following message: `This procedure is not supported for Non-Disruptive Upgrade on an HA pair`. The note applies to nondisruptive upgrades of ONTAP, and not upgrades of controllers. Always use netboot to update the new node to the desired image. If you use another method to install the image on the new controller, the wrong image might install. This issue applies to all ONTAP releases.

. If you are prompted to continue the procedure, enter `y`, and when prompted for the package, enter the URL:
+
`http://<web_server_ip/path_to_web-accessible_directory>/<ontap_version>_image.tgz`

. Complete the following substeps to reboot the controller module:
.. Enter `n` to skip the backup recovery when you see the following prompt:

....
Do you want to restore the backup configuration now? {y|n}
....

.. Reboot by entering `y `when you see the following prompt:

....
The node must be rebooted to start using the newly installed software. Do you want to reboot now? {y|n}
....

The controller module reboots but stops at the boot menu because the boot device was reformatted, and the configuration data needs to be restored.

. Select maintenance mode `5` from the boot menu and enter `y` when you are prompted to continue with the boot.
. Verify that the controller and chassis are configured as HA by using the following command:
+
`ha-config show`
+
The following example shows the output of the `ha-config show` command:

....
Chassis HA configuration: ha
Controller HA configuration: ha
....

[NOTE]
System records in a PROM whether they are in an HA pair or stand-alone configuration. The state must be the same on all components within the stand-alone system or HA pair.

. If the controller and chassis are not configured as HA, use the following commands to correct the configuration:
+
`ha- config modify controller`
+
`ha ha- config modify chassis ha`
+
If you have a MetroCluster configuration, use the following commands to modify the controller and chassis:
+
`ha-config modify controller mcc`
+
`ha-config modify chassis mcc`

. Exit maintenance mode by using the following command:
+
`halt`
+
Interrupt the autoboot by pressing Ctrl-C at the boot environment prompt.

. On node3, check the system date, time, and time zone by using the following command:
+
`date`

. On node4, check the date by using the following command at the boot environment prompt:
+
`show date`

. If necessary, set the date on node4 by using the following command:
+
`set date <mm/dd/yyyy>`

. On node4, check the time by using the following command at the boot environment prompt:
+
`show time`

. If necessary, set the time on node4 by using the following command:
+
`set time <hh:mm:ss>`

. If necessary, set the partner system ID on node4 by using the following command:
+
`setenv partner- sysid <node2_sysid>`

.. Save the settings:
+
`saveenv`

. On the new node, in boot loader, the `partner- sysid` parameter must be set. For node4, `partner- sysid` must be that of node3. Verify the `partner- sysid` for node3 using the following command:
+
`printenv partner- sysid`

. Take one of the following actions:

|===
|If your system... |Description

|Has disks and no back-end storage
|Go to xref Step 23
|Is a V-Series system or a system with FlexArray Virtualization software connected to storage arrays
|Go to section xref Setting the FC or UTA/UTA2 configuration on node4 and complete the subsections in this section.
Return to this section and complete the remaining steps, beginning with xref Step 23.

Important: You must reconfigure FC onboard ports, CNA onboard ports, and CNA cards before you boot ONTAP on the V-Series or system with FlexArray Virtualization software.
|===

. Add the FC initiator ports of the new node to the switch zones.
+
If your system has a tape SAN, then you need zoning for the initiators. If required, modify the onboard ports to initiator by referring to the *xref *Configuring FC ports on node4. See your storage array and zoning documentation for further instructions on zoning.

. Add the FC initiator ports to the storage array as new hosts, mapping the array LUNs to the new hosts.
+
See your storage array and zoning documentation for instructions.

. Modify the worldwide port name (WWPN) values in the host or volume groups associated with array LUNs on the storage array.
+
Installing a new controller module changes the WWPN values associated with each onboard FC port.

. If your configuration uses switch-based zoning, adjust the zoning to reflect the new WWPN values.
. If NetApp Storage Encryption (NSE) is in use on this configuration, the `setenv` `bootarg.storageencryption.support` command must be set to `true`, and the `kmip.init.maxwait` variable needs to be set to `off` to avoid a boot loop after the node1 configuration is loaded:
+
`setenv bootarg.storageencryption.support true`
+
`setenv kmip.init.maxwait off`

. Boot node into boot menu by using the following command:
+
`boot_ontap menu`
+
If you do not have FC or UTA/UTA2 configuration, execute Step 15 so that node4 can recognize node2â€™s disks.

. For MetroCluster configuration, V-Series systems and systems with FlexArray Virtualization software connected to storage arrays go to Step 15.

==== Related information

*XREF* ONTAP 9 Documentation Center
